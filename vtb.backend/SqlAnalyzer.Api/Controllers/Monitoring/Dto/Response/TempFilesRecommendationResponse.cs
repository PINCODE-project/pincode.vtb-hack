namespace SqlAnalyzer.Api.Controllers.Monitoring.Dto.Response;

/// <summary>
/// Модель ответа для анализа временных файлов базы данных
/// Содержит результаты анализа использования временных файлов PostgreSQL за определенный период
/// Используется для выявления проблем с производительностью, связанных с временными файлами
/// </summary>
public class TempFilesRecommendationResponse
{
    /// <summary>
    /// Начальная дата и время периода анализа
    /// Определяет момент начала сбора метрик временных файлов
    /// </summary>
    public DateTime AnalysisPeriodStart { get; set; }
    
    /// <summary>
    /// Конечная дата и время периода анализа
    /// Определяет момент окончания сбора метрик временных файлов
    /// </summary>
    public DateTime AnalysisPeriodEnd { get; set; }
    
    /// <summary>
    /// Список рекомендаций по оптимизации работы с временными файлами
    /// Содержит конкретные предложения по уменьшению использования временных файлов
    /// </summary>
    public List<TempFilesRecommendation> Recommendations { get; set; } = new();
    
    /// <summary>
    /// Сводка метрик временных файлов за анализируемый период
    /// Включает ключевые показатели использования временных файлов
    /// </summary>
    public TempFilesMetricsSummary MetricsSummary { get; set; } = new();
}

/// <summary>
/// Рекомендации по оптимизации работы с временными файлами базы данных
/// Представляет конкретные предложения по настройке параметров, влияющих на временные файлы
/// </summary>
public class TempFilesRecommendation
{
    /// <summary>
    /// Тип рекомендации по оптимизации временных файлов
    /// "work_mem" - увеличение памяти для операций сортировки и хэширования,
    /// "temp_buffers" - настройка буферов для временных таблиц,
    /// "query_optimization" - оптимизация запросов, генерирующих временные файлы,
    /// "maintenance_work_mem" - увеличение памяти для операций обслуживания,
    /// "temp_file_limit" - установка лимита временных файлов
    /// </summary>
    public string Type { get; set; } = string.Empty;
    
    /// <summary>
    /// Уровень серьезности рекомендации
    /// "low" - низкий приоритет (незначительное влияние на производительность),
    /// "medium" - средний приоритет (заметное влияние на производительность),
    /// "high" - высокий приоритет (критическое влияние на производительность)
    /// </summary>
    public string Severity { get; set; } = string.Empty;
    
    /// <summary>
    /// Детальное описание рекомендации и обоснование
    /// Содержит объяснение проблемы, последствия и ожидаемый эффект от применения
    /// </summary>
    public string Message { get; set; } = string.Empty;
    
    /// <summary>
    /// Текущее значение параметра (если применимо)
    /// Актуальное значение настройки, которое требует оптимизации
    /// </summary>
    public double CurrentValue { get; set; }
    
    /// <summary>
    /// Пороговое значение для срабатывания рекомендации
    /// Значение, при превышении которого рекомендация становится актуальной
    /// Например: лимит временных файлов или объем используемой памяти
    /// </summary>
    public double Threshold { get; set; }
}

/// <summary>
/// Метрики специфичные для анализа временных файлов базы данных
/// Содержит статистические данные о создании и использовании временных файлов
/// </summary>
public class TempFilesMetricsSummary
{
    /// <summary>
    /// Общее количество созданных временных файлов за период анализа
    /// Высокое значение может указывать на нехватку work_mem
    /// </summary>
    public long TotalTempFiles { get; set; }
    
    /// <summary>
    /// Общий объем данных в байтах, записанных во временные файлы
    /// Большой объем указывает на интенсивное использование диска для временных операций
    /// </summary>
    public long TotalTempBytes { get; set; }
    
    /// <summary>
    /// Среднее количество временных файлов, создаваемых в минуту
    /// Показывает интенсивность создания временных файлов
    /// </summary>
    public double TempFilesPerMinute { get; set; }
    
    /// <summary>
    /// Средний объем данных в байтах, записываемых во временные файлы в минуту
    /// Показывает интенсивность использования диска для временных операций
    /// </summary>
    public double TempBytesPerMinute { get; set; }
    
    /// <summary>
    /// Средний объем данных в байтах, записываемых во временные файлы в секунду
    /// Ключевой показатель нагрузки на подсистему ввода-вывода
    /// </summary>
    public double TempBytesPerSecond { get; set; }
}
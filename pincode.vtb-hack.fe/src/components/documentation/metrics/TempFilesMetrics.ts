import type { MetricSection } from "./types";

/**
 * Данные метрик Временных файлов для анализа настроек БД
 */
export const tempFilesMetrics: MetricSection = {
	title: "Метрики Временных файлов",
	items: [
		{
			title: "Критический рост объема временных файлов",
			metric: "Скорость записи во временные файлы",
			threshold: "> 1 MB/сек",
			level: "critical",
			description: "Серьезная нехватка памяти work_mem для операций сортировки, агрегации и хэширования.",
			recommendations: [
				"Немедленно увеличить параметр work_mem для пользовательских сессий",
				"Оптимизировать запросы с большими сортировками и агрегациями",
				"Рассмотреть увеличение общей оперативной памяти сервера",
			],
		},
		{
			title: "Высокий рост количества временных файлов",
			metric: "Количество файлов в минуту",
			threshold: "> 2 файлов/мин",
			level: "high",
			description: "Нехватка памяти work_mem для операций сортировки и агрегации.",
			recommendations: [
				"Увеличить параметр work_mem в конфигурации PostgreSQL",
				"Проанализировать и оптимизировать запросы с ORDER BY, GROUP BY, DISTINCT",
				"Создать индексы для поддержки операций сортировки и агрегации",
			],
		},
		{
			title: "Стабильная работа",
			metric: "Комбинированные показатели",
			threshold: "< 2 файлов/мин И < 1 MB/сек",
			level: "low",
			description:
				"Система работает стабильно, операции сортировки и агрегации преимущественно выполняются в памяти.",
			recommendations: [
				"Продолжать регулярный мониторинг показателей",
				"Периодически анализировать планы запросов на предмет эффективности",
				"Следить за ростом объема данных и корректировать настройки памяти",
			],
		},
	],
};
